<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Centre Court - Championship Tennis</title>
    <link rel="preload" href="court.jpg" as="image">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;800&display=swap');
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
        body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#1a1a2e,#0f0f1e);height:100vh;overflow:hidden;touch-action:none;overscroll-behavior:none;position:fixed;width:100%}
        .screen{position:fixed;inset:0;display:none;flex-direction:column;z-index:100}
        .screen.active{display:flex}
        .loading-screen{background:#000;justify-content:center;align-items:center;z-index:10000;overflow:hidden}
        .hero-image{position:relative;width:64vw;height:57vh;margin-bottom:15px;display:flex;justify-content:center;align-items:center}
        .hero-player{position:absolute;width:100%;height:100%;opacity:0;animation:slideInPlayer 0.6s ease-out 0.8s forwards;image-rendering:pixelated;clip-path:inset(0 20% 0 0);object-fit:contain}
        .hero-ball{position:absolute;width:100%;height:100%;opacity:0;animation:slideInBall 1.4s ease-in-out forwards;image-rendering:pixelated;clip-path:inset(0 0 0 80%);object-fit:contain}
        @keyframes slideInPlayer{0%{opacity:0;transform:translateX(-100vw)}100%{opacity:1;transform:translateX(0)}}
        @keyframes slideInBall{0%{opacity:0;transform:translateX(100vw)}100%{opacity:1;transform:translateX(0)}}
        .loading-content{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;animation:fadeInContent 0.8s ease-out 1.4s forwards;opacity:0;margin-top:-70px}
        @keyframes fadeInContent{0%{opacity:0;transform:translateY(20px)}100%{opacity:1;transform:translateY(0)}}
        .loading-logo{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,12vw,72px);background:linear-gradient(135deg,#9b59b6,#bb86fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:6px;text-shadow:0 0 30px rgba(187,134,252,0.3)}
        .loading-subtitle{color:rgba(255,255,255,0.5);font-size:13px;letter-spacing:5px;text-transform:uppercase;margin-bottom:50px}
        .play-button{padding:18px 70px;background:#fff;border:none;border-radius:35px;color:#1a1a2e;font-size:15px;font-weight:700;letter-spacing:3px;text-transform:uppercase;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.3);transition:transform 0.2s,box-shadow 0.2s}
        .play-button:hover{transform:scale(1.05);box-shadow:0 15px 40px rgba(0,0,0,0.4)}
        .main-menu{background:#000;justify-content:space-between;padding:15px;overflow-y:auto}
        .game-logo{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,12vw,72px);background:linear-gradient(135deg,#9b59b6,#bb86fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center;letter-spacing:6px;text-shadow:0 0 30px rgba(187,134,252,0.3)}
        .tagline{font-size:11px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,215,0,0.6);text-align:center}
        .player-card{background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,237,78,0.05));border:2px solid rgba(255,215,0,0.2);border-radius:15px;padding:15px;margin:10px 0}
        .player-level{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
        .level-badge{background:linear-gradient(135deg,#667eea,#764ba2);padding:6px 15px;border-radius:20px;font-size:12px;font-weight:700;color:#fff}
        .skill-progress{margin-bottom:15px}
        .skill-label{font-size:9px;color:rgba(255,215,0,0.8);margin-bottom:6px;text-align:center}
        .skill-bar{height:8px;background:rgba(0,0,0,0.3);border-radius:10px;overflow:hidden}
        .skill-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:0%;transition:width 0.3s}
        .currency-display{display:flex;gap:15px}
        .currency-item{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.3);padding:6px 12px;border-radius:15px}
        .currency-icon{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px}
        .coins{background:linear-gradient(135deg,#ffd700,#ffed4e)}
        .gems{background:linear-gradient(135deg,#e74c3c,#c0392b)}
        .currency-amount{font-family:'Bebas Neue',sans-serif;font-size:24px;color:#fff}
        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .stat-item{text-align:center;background:rgba(0,0,0,0.3);padding:10px;border-radius:12px}
        .stat-label{font-size:9px;text-transform:uppercase;color:rgba(255,215,0,0.6)}
        .stat-value{font-family:'Bebas Neue',sans-serif;font-size:24px;background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .difficulty-section{margin:10px 0}
        .difficulty-title{text-align:center;color:rgba(255,215,0,0.8);font-size:11px;text-transform:uppercase;letter-spacing:2px;margin-bottom:10px}
        .difficulty-buttons{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
        .difficulty-btn{padding:12px 8px;border:2px solid rgba(255,255,255,0.2);border-radius:12px;background:rgba(255,255,255,0.05);color:#fff;font-size:10px;font-weight:600;text-transform:uppercase;cursor:pointer}
        .difficulty-btn.selected{border-color:#ffd700;background:rgba(255,215,0,0.15)}
        .diff-rookie{border-color:#4caf50}
        .diff-pro{border-color:#ff9800}
        .diff-legend{border-color:#f44336}
        .difficulty-reward{display:block;font-size:8px;color:rgba(255,255,255,0.6);margin-top:3px}
        .menu-buttons{display:flex;flex-direction:column;gap:12px}
        .menu-btn{padding:15px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:12px;color:#fff;font-size:13px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer}
        .menu-btn.primary{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#1a1a2e;font-size:15px;padding:18px}
        .video-intro{position:fixed;inset:0;background:#000;display:none;z-index:5000;justify-content:center;align-items:center;opacity:1;transition:opacity 0.5s ease}
        .video-intro.active{display:flex}
        .video-intro.fade-out{opacity:0}
        #videoPlayer{width:100vw;height:100vh;object-fit:cover}
        .game-hud{position:fixed;top:0;left:0;right:0;padding:15px;display:none;z-index:100;background:linear-gradient(to bottom,rgba(0,0,0,0.7),transparent)}
        .game-hud.active{display:block}
        .match-info{display:flex;justify-content:space-between;align-items:center}
        .player-info{background:rgba(0,0,0,0.5);padding:12px 20px;border-radius:15px;border:1px solid rgba(255,215,0,0.3);text-align:center}
        .player-name{font-size:10px;text-transform:uppercase;color:rgba(255,215,0,0.8)}
        .player-points{font-family:'Bebas Neue',sans-serif;font-size:36px;background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .player-games{font-size:9px;color:rgba(255,255,255,0.7);margin-top:4px}
        .match-center{display:flex;flex-direction:column;align-items:center;gap:5px}
        .match-timer{background:rgba(255,215,0,0.2);padding:8px 20px;border-radius:20px;color:#fff;font-size:14px;font-weight:700}
        .rally-counter{font-size:10px;color:rgba(255,255,255,0.7);text-transform:uppercase}
        .game-court{position:fixed;inset:0;display:none;background:url('court.jpg') center/cover no-repeat;background-color:#000}
        .game-court.active{display:block}
        .court{position:absolute;top:12%;left:8%;right:8%;bottom:12%;background:transparent;border:none;overflow:hidden}
        .court-lines{position:absolute;inset:0;display:none}
        .line{position:absolute;background:#fff;opacity:0.95}
        .sideline-left{left:12%;top:0;bottom:0;width:3px}
        .sideline-right{right:12%;top:0;bottom:0;width:3px}
        .baseline-top{top:6%;left:0;right:0;height:3px}
        .baseline-bottom{bottom:6%;left:0;right:0;height:3px}
        .service-top{top:27%;left:12%;right:12%;height:2px}
        .service-bottom{bottom:27%;left:12%;right:12%;height:2px}
        .center-service{left:50%;top:27%;bottom:27%;width:2px}
        .net{top:50%;left:-2%;right:-2%;height:6px;background:linear-gradient(to bottom,rgba(255,255,255,0.9),rgba(100,100,100,0.9));z-index:20;transform:translateY(-50%)}
        .ball{position:absolute;width:14px;height:14px;background:radial-gradient(circle at 30% 30%,#fcf836,#c9d11a);border-radius:50%;transform:translate(-50%,-50%);z-index:40;display:none;box-shadow:0 2px 4px rgba(0,0,0,0.4)}
        .ball.active{display:block}
        .ball.glowing{box-shadow:0 0 30px rgba(76,255,80,1),0 0 50px rgba(76,255,80,0.5);animation:ballGlow 0.4s ease-in-out infinite}
        @keyframes ballGlow{0%,100%{transform:translate(-50%,-50%) scale(1.3)}50%{transform:translate(-50%,-50%) scale(1.6)}}
        .ball-shadow{position:absolute;width:20px;height:8px;background:radial-gradient(ellipse at center,rgba(0,0,0,0.4),transparent 70%);border-radius:50%;transform:translate(-50%,0);z-index:25;display:none}
        .ball-shadow.active{display:block}
        .opponent{position:absolute;top:5%;left:50%;transform:translateX(-50%);width:80px;height:96px;display:flex;align-items:center;justify-content:center;z-index:30;transition:left 0.2s ease-out}
        .opponent.hitting{animation:opponentHit 0.3s ease}
        @keyframes opponentHit{50%{transform:translateX(-50%) scale(1.2) rotate(-5deg)}}
        .player-paddle{position:absolute;bottom:5%;width:86px;height:104px;display:flex;align-items:center;justify-content:center;transform:translateX(-50%);transition:left 0.1s ease-out;z-index:35}
        .player-paddle.can-hit{filter:drop-shadow(0 0 20px rgba(76,255,80,0.8));animation:paddleReady 0.4s ease-in-out infinite}
        @keyframes paddleReady{0%,100%{transform:translateX(-50%) scale(1.05)}50%{transform:translateX(-50%) scale(1)}}
        .player-sprite{position:relative;width:80px;height:96px;overflow:hidden;image-rendering:pixelated;transform:scale(1);transition:transform 0.2s ease}
        .player-sprite.flipped{transform:scaleX(-1)}
        .player-sprite.near{transform:scale(1.13)}
        .player-sprite.near.flipped{transform:scale(1.13) scaleX(-1)}
        .sprite-inner{width:80px;height:96px;background-size:640px 96px;background-repeat:no-repeat;background-position:0 0}
        .sprite-inner.playing-8{animation:playSprite8 0.5s steps(7) 1}
        .sprite-inner.playing-7{animation:playSprite7 0.5s steps(6) 1}
        .sprite-inner.playing-5{animation:playSprite5 0.5s steps(4) 1}
        .sprite-inner.playing-4{animation:playSprite4 0.4s steps(3) 1}
        .sprite-inner.cycling{animation:playSprite8 0.5s steps(7) infinite}
        @keyframes playSprite8{0%{background-position:0 0}100%{background-position:-560px 0}}
        @keyframes playSprite7{0%{background-position:0 0}100%{background-position:-360px 0}}
        @keyframes playSprite5{0%{background-position:0% var(--sprite-y)}100%{background-position:100% var(--sprite-y)}}
        @keyframes playSprite4{0%{background-position:0% var(--sprite-y)}100%{background-position:100% var(--sprite-y)}}
        .hit-zone{position:absolute;bottom:8%;left:8%;right:8%;top:52%;border:3px dashed rgba(255,215,0,0.2);border-radius:20px;pointer-events:none;z-index:5;display:none}
        .hit-zone.active{border-color:rgba(76,255,80,0.4);background:rgba(76,255,80,0.05)}
        .power-bar{position:absolute;bottom:2%;left:20%;right:20%;height:12px;background:rgba(0,0,0,0.5);border:2px solid rgba(255,215,0,0.5);border-radius:6px;overflow:hidden;display:none}
        .power-fill{height:100%;width:0%;background:linear-gradient(90deg,#4caf50,#ffd700,#f44336);transition:width 0.15s}
        .hit-effect{position:absolute;width:120px;height:120px;border:4px solid #ffd700;border-radius:50%;opacity:0;pointer-events:none;transform:translate(-50%,-50%) scale(0.5);z-index:200;display:none}
        .hit-effect.active{animation:hitRipple 0.6s ease-out}
        @keyframes hitRipple{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}100%{opacity:0;transform:translate(-50%,-50%) scale(2.5)}}
        .gem-drop{position:absolute;width:40px;height:40px;font-size:32px;display:none;transform:translate(-50%,-50%);z-index:150;animation:gemFloat 2s ease-in-out infinite;cursor:pointer}
        .gem-drop.active{display:block}
        @keyframes gemFloat{0%,100%{transform:translate(-50%,-50%) scale(1) rotate(0deg)}50%{transform:translate(-50%,-60%) scale(1.2) rotate(180deg)}}
        .combo-text{position:absolute;font-family:'Bebas Neue',sans-serif;font-size:42px;background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;pointer-events:none;z-index:500}
        @keyframes comboFloat{0%{opacity:1;transform:translate(-50%,-50%) scale(0)}50%{opacity:1;transform:translate(-50%,-80px) scale(1.4)}100%{opacity:0;transform:translate(-50%,-120px) scale(1)}}
        .swipe-hint{position:absolute;bottom:45%;left:50%;transform:translateX(-50%);padding:8px 16px;background:rgba(76,255,80,0.6);border-radius:8px;color:#fff;font-size:12px;font-weight:700;text-transform:uppercase;opacity:0;pointer-events:none;display:none}
        .swipe-hint.active{opacity:1;animation:hintPulse 0.8s ease-in-out infinite}
        @keyframes hintPulse{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.1)}}
        .match-results{background:#000;justify-content:center;align-items:center;padding:20px;z-index:2000}
        .results-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,15vw,64px);margin-bottom:10px}
        .victory{background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .defeat{background:linear-gradient(135deg,#f44336,#e91e63);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .final-score{font-family:'Bebas Neue',sans-serif;font-size:42px;color:#fff;margin-bottom:25px}
        .rewards-container{background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,237,78,0.05));border:2px solid rgba(255,215,0,0.3);border-radius:20px;padding:20px;margin-bottom:25px;width:100%;max-width:320px}
        .rewards-title{font-size:13px;text-transform:uppercase;letter-spacing:3px;color:rgba(255,215,0,0.8);margin-bottom:15px;text-align:center}
        .reward-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,215,0,0.1)}
        .reward-item:last-child{border-bottom:none}
        .reward-label{font-size:13px;color:rgba(255,255,255,0.8);text-transform:uppercase}
        .reward-value{font-family:'Bebas Neue',sans-serif;font-size:28px;background:linear-gradient(135deg,#4caf50,#8bc34a);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .continue-btn{padding:18px 50px;background:linear-gradient(135deg,#ffd700,#ffed4e);border:none;border-radius:25px;color:#1a1a2e;font-size:15px;font-weight:700;letter-spacing:2px;text-transform:uppercase;cursor:pointer}
        .progress-toast{position:fixed;top:-80px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ffd700,#ffed4e);padding:12px 25px;border-radius:25px;color:#1a1a2e;font-weight:700;z-index:3000;transition:top 0.4s ease}
        .progress-toast.show{top:40px}
        .shop-screen{background:#000;padding:15px;overflow-y:auto;z-index:1100}
        .shop-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
        .shop-title{font-family:'Bebas Neue',sans-serif;font-size:26px;background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .back-btn{padding:10px 20px;background:rgba(255,255,255,0.1);border:2px solid rgba(255,215,0,0.3);border-radius:8px;color:#ffd700;font-size:11px;font-weight:700;text-transform:uppercase;cursor:pointer}
        .shop-tabs{display:flex;gap:6px;margin-bottom:15px;background:rgba(0,0,0,0.3);padding:4px;border-radius:10px}
        .shop-tab{flex:1;padding:10px;background:transparent;border:none;border-radius:6px;color:rgba(255,255,255,0.6);font-size:10px;font-weight:700;text-transform:uppercase;cursor:pointer}
        .shop-tab.active{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#1a1a2e}
        .shop-items{display:grid;gap:10px;padding-bottom:20px;overflow-y:auto;max-height:calc(100vh - 180px)}
        .shop-item{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,237,78,0.04));border:1px solid rgba(255,215,0,0.2);border-radius:12px;padding:12px;display:flex;justify-content:space-between;align-items:center}
        .shop-item.owned{border-color:#4caf50}
        .item-info{flex:1;max-width:55%}
        .item-name{font-size:13px;font-weight:700;color:#fff;margin-bottom:2px}
        .item-desc{font-size:9px;color:rgba(255,255,255,0.6);margin-bottom:4px}
        .item-stats{display:flex;gap:6px;flex-wrap:wrap}
        .item-stat{font-size:8px;color:#4caf50;font-weight:600;background:rgba(76,175,80,0.2);padding:2px 5px;border-radius:4px}
        .item-purchase{display:flex;flex-direction:column;align-items:center;gap:6px}
        .price-tag{display:flex;align-items:center;gap:5px;padding:5px 8px;background:rgba(0,0,0,0.4);border-radius:6px;font-family:'Bebas Neue',sans-serif;font-size:18px;color:#fff}
        .buy-btn{padding:7px 14px;background:linear-gradient(135deg,#4caf50,#8bc34a);border:none;border-radius:6px;color:#fff;font-size:9px;font-weight:700;text-transform:uppercase;cursor:pointer}
        .buy-btn:disabled{background:#555;opacity:0.5}
        .equip-btn{padding:7px 14px;background:linear-gradient(135deg,#2196f3,#03a9f4);border:none;border-radius:6px;color:#fff;font-size:9px;font-weight:700;text-transform:uppercase;cursor:pointer}
        .equipped-badge{padding:7px 14px;background:linear-gradient(135deg,#ffd700,#ffed4e);border:none;border-radius:6px;color:#1a1a2e;font-size:9px;font-weight:700;text-transform:uppercase}
        .tutorial-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;justify-content:center;align-items:center;z-index:3000;padding:20px}
        .tutorial-overlay.active{display:flex}
        .tutorial-content{background:#000;border:2px solid rgba(187,134,252,0.4);border-radius:20px;padding:25px;max-width:360px;text-align:center}
        .tutorial-title{font-family:'Bebas Neue',sans-serif;font-size:32px;background:linear-gradient(135deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px}
        .tutorial-text{color:rgba(255,255,255,0.8);font-size:13px;line-height:1.5;margin-bottom:20px}
        .tutorial-btn{padding:14px 35px;background:linear-gradient(135deg,#4caf50,#8bc34a);border:none;border-radius:20px;color:#fff;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer}
    </style>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <div class="screen loading-screen active" id="loadingScreen">
        <div style="display:flex;flex-direction:column;align-items:center;margin-top:-60px;">
            <div class="hero-image">
                <img src="hero_player.jpg" alt="Tennis Player" class="hero-player">
                <img src="hero_player.jpg" alt="Tennis Ball" class="hero-ball">
            </div>
            <div class="loading-content">
                <div class="loading-logo">CENTRE COURT</div>
                <div class="loading-subtitle">Championship Edition</div>
                <button class="play-button" onclick="startGame()">PLAY NOW</button>
            </div>
        </div>
    </div>
    <div class="screen main-menu" id="mainMenu">
        <div><h1 class="game-logo">CENTRE COURT</h1><p class="tagline">Championship Edition</p></div>
        <div class="player-card">
            <div class="player-level">
                <div class="level-badge">NTRP <span id="playerNTRP">2.5</span></div>
                <div class="currency-display">
                    <div class="currency-item"><div class="currency-icon coins">ðŸ’°</div><div class="currency-amount" id="coinAmount">500</div></div>
                    <div class="currency-item"><div class="currency-icon gems">ðŸ’Ž</div><div class="currency-amount" id="gemAmount">20</div></div>
                </div>
            </div>
            <div class="skill-progress">
                <div class="skill-label">Skill Points: <span id="skillPoints">0</span> / <span id="skillNeeded">300</span></div>
                <div class="skill-bar"><div class="skill-fill" id="skillFill"></div></div>
            </div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-label">Power</div><div class="stat-value" id="statPower">10</div></div>
                <div class="stat-item"><div class="stat-label">Speed</div><div class="stat-value" id="statSpeed">10</div></div>
                <div class="stat-item"><div class="stat-label">Control</div><div class="stat-value" id="statControl">10</div></div>
            </div>
        </div>
        <div class="difficulty-section">
            <div class="difficulty-title">Select Difficulty</div>
            <div class="difficulty-buttons">
                <button class="difficulty-btn diff-rookie selected" onclick="selectDifficulty('rookie')">Rookie<span class="difficulty-reward">1x Rewards</span></button>
                <button class="difficulty-btn diff-pro" onclick="selectDifficulty('pro')">Pro<span class="difficulty-reward">2x Rewards</span></button>
                <button class="difficulty-btn diff-legend" onclick="selectDifficulty('legend')">Legend<span class="difficulty-reward">3x Rewards</span></button>
            </div>
        </div>
        <div class="menu-buttons">
            <button class="menu-btn primary" onclick="startMatch()">PLAY MATCH</button>
            <button class="menu-btn" onclick="showShop()">PRO SHOP</button>
            <button class="menu-btn" onclick="showTutorial()">HOW TO PLAY</button>
        </div>
    </div>
    <div class="screen shop-screen" id="shopScreen">
        <div class="shop-header"><h2 class="shop-title">PRO SHOP</h2><button class="back-btn" onclick="closeShop()">BACK</button></div>
        <div class="shop-tabs">
            <button class="shop-tab active" onclick="switchTab('training',this)">Training</button>
            <button class="shop-tab" onclick="switchTab('rackets',this)">Rackets</button>
            <button class="shop-tab" onclick="switchTab('shoes',this)">Shoes</button>
            <button class="shop-tab" onclick="switchTab('special',this)">Special</button>
        </div>
        <div class="shop-items" id="shopItems"></div>
    </div>
    <div class="video-intro" id="videoIntro">
        <div id="videoPlayer"></div>
    </div>
    <div class="game-hud" id="gameHUD">
        <div class="match-info">
            <div class="player-info">
                <div class="player-name">YOU</div>
                <div class="player-points" id="playerPoints">0</div>
                <div class="player-games">Games: <span id="playerGames">0</span></div>
            </div>
            <div class="match-center">
                <div class="match-timer" id="matchTimer">2:00</div>
                <div class="rally-counter">Rally: <span id="rallyCount">0</span></div>
            </div>
            <div class="player-info">
                <div class="player-name">CPU</div>
                <div class="player-points" id="opponentPoints">0</div>
                <div class="player-games">Games: <span id="opponentGames">0</span></div>
            </div>
        </div>
    </div>
    <div class="game-court" id="gameCourt">
        <div class="court">
            <div class="court-lines">
                <div class="line sideline-left"></div><div class="line sideline-right"></div>
                <div class="line baseline-top"></div><div class="line baseline-bottom"></div>
                <div class="line service-top"></div><div class="line service-bottom"></div>
                <div class="line center-service"></div><div class="line net"></div>
            </div>
            <div class="hit-zone" id="hitZone"></div>
            <div class="opponent" id="opponent">
                <div class="player-sprite opponent-sprite">
                    <div class="sprite-inner" id="opponentSprite"></div>
                </div>
            </div>
            <div class="player-paddle" id="playerPaddle">
                <div class="player-sprite player-sprite-active near">
                    <div class="sprite-inner" id="playerSprite"></div>
                </div>
            </div>
            <div class="ball-shadow" id="ballShadow"></div>
            <div class="ball" id="ball"></div>
            <div class="swipe-hint" id="swipeHint">SWIPE UP!</div>
            <div class="power-bar"><div class="power-fill" id="powerFill"></div></div>
            <div class="hit-effect" id="hitEffect"></div>
            <div class="gem-drop" id="gemDrop">ðŸ’Ž</div>
        </div>
    </div>
    <div class="screen match-results" id="matchResults">
        <h2 class="results-title" id="resultsTitle">VICTORY</h2>
        <div class="final-score" id="finalScore">7 - 3</div>
        <div class="rewards-container">
            <div class="rewards-title">Match Rewards</div>
            <div class="reward-item"><span class="reward-label">Coins</span><span class="reward-value" id="coinsEarned">+50</span></div>
            <div class="reward-item"><span class="reward-label">Skill Points</span><span class="reward-value" id="skillGained">+100</span></div>
            <div class="reward-item"><span class="reward-label">Gems</span><span class="reward-value" id="gemsEarned">+0</span></div>
        </div>
        <button class="continue-btn" onclick="returnToMenu()">CONTINUE</button>
    </div>
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <h2 class="tutorial-title">HOW TO PLAY</h2>
            <p class="tutorial-text"><strong>Watch for the GREEN GLOW!</strong><br><br>When the ball enters your zone, it glows green - that's your signal!<br><br><strong>Controls:</strong><br>â€¢ SWIPE UP to hit with power<br>â€¢ TAP for a quick return<br>â€¢ Move finger left/right to position<br><br>Better equipment = real advantages!</p>
            <button class="tutorial-btn" onclick="closeTutorial()">GOT IT!</button>
        </div>
    </div>
    <div class="progress-toast" id="progressToast"></div>
<script>
const G={coins:500,gems:20,level:1,xp:0,ntrp:2.5,skillPoints:0,stats:{power:10,speed:10,control:10},equipment:{racket:null,shoes:null,special:null},owned:[],difficulty:'rookie',trainingCompleted:[]};
const SHOP={rackets:[{id:'r1',name:'Starter Racket',desc:'Basic frame',stats:{power:5,control:5},price:100,currency:'coins'},{id:'r2',name:'Power Driver',desc:'Heavy devastating shots',stats:{power:20,control:5},price:500,currency:'coins'},{id:'r3',name:'Precision Pro',desc:'Perfect balance',stats:{power:10,control:25,speed:5},price:750,currency:'coins'},{id:'r4',name:'Champions Blade',desc:'Used by pros',stats:{power:25,control:25,speed:10},price:100,currency:'gems'},{id:'r5',name:'Graphite Pro',desc:'Lightweight power',stats:{power:15,speed:8,control:15},price:1200,currency:'coins'},{id:'r6',name:'Legend Series',desc:'Tournament champion gear',stats:{power:30,speed:5,control:30},price:200,currency:'gems'}],shoes:[{id:'s1',name:'Court Runners',desc:'Standard shoes',stats:{speed:10,control:5},price:150,currency:'coins'},{id:'s2',name:'Lightning Sprints',desc:'Ultra-light speed',stats:{speed:30,control:10},price:600,currency:'coins'},{id:'s3',name:'Pro Tour Elite',desc:'Professional grade',stats:{power:5,speed:20,control:15},price:1000,currency:'coins'},{id:'s4',name:'Rocket Boosters',desc:'Experimental tech',stats:{power:10,speed:40,control:20},price:75,currency:'gems'},{id:'s5',name:'Clay Court Masters',desc:'Grip on any surface',stats:{speed:25,control:20},price:1500,currency:'coins'},{id:'s6',name:'Grand Slam Edition',desc:'Worn by champions',stats:{power:8,speed:35,control:25},price:120,currency:'gems'}],special:[{id:'x1',name:'Lucky Charm',desc:'2x coin rewards',stats:{bonus:'2x Coins'},price:150,currency:'gems'},{id:'x2',name:'Power Band',desc:'Massive power boost',stats:{power:40},price:50,currency:'gems'},{id:'x3',name:'Focus Lens',desc:'Slow-motion hit zone',stats:{control:50},price:200,currency:'gems'},{id:'x4',name:'Energy Drink',desc:'Faster movement speed',stats:{speed:25},price:30,currency:'gems'},{id:'x5',name:'Sweatband Pro',desc:'Better stamina',stats:{power:10,speed:10,control:10},price:80,currency:'gems'},{id:'x6',name:'Tournament Trophy',desc:'Prestige item, all stats',stats:{power:20,speed:20,control:20},price:300,currency:'gems'}],training:[{id:'t1',name:'Private Coaching',desc:'1-on-1 lesson with a pro',stats:{skillPoints:100,power:3,control:3},price:250,currency:'coins',repeatable:true},{id:'t2',name:'Group Clinic',desc:'Learn with others',stats:{skillPoints:50,power:2,speed:1},price:100,currency:'coins',repeatable:true},{id:'t3',name:'Ball Machine',desc:'Practice alone, perfect shots',stats:{skillPoints:75,control:4,speed:1},price:150,currency:'coins',repeatable:true},{id:'t4',name:'Hit with a Friend',desc:'Casual practice session',stats:{skillPoints:30,power:1,speed:1,control:1},price:50,currency:'coins',repeatable:true},{id:'t5',name:'Join Flex League',desc:'Competitive match play',stats:{skillPoints:200,power:5,speed:3,control:5},price:500,currency:'coins',repeatable:true},{id:'t6',name:'Elite Training Camp',desc:'Intensive weekend program',stats:{skillPoints:500,power:10,speed:10,control:10},price:150,currency:'gems',repeatable:true},{id:'t7',name:'Video Analysis',desc:'Study your technique',stats:{skillPoints:150,control:8,power:4},price:350,currency:'coins',repeatable:true},{id:'t8',name:'Fitness Bootcamp',desc:'Build endurance',stats:{skillPoints:120,speed:7,power:5},price:300,currency:'coins',repeatable:true}]};
const DIFF={rookie:{speed:1.1,oppSpeed:0.07,hitWindow:0.38,oppAcc:0.65,mult:1,time:120},pro:{speed:1.5,oppSpeed:0.11,hitWindow:0.28,oppAcc:0.8,mult:2,time:150},legend:{speed:2,oppSpeed:0.16,hitWindow:0.18,oppAcc:0.92,mult:3,time:180}};
let M={active:false,pPoints:0,oPoints:0,pGames:0,oGames:0,time:120,rally:0,ballActive:false,ballPos:{x:50,y:10},ballVel:{x:0,y:0,z:0},ballH:100,ballBounces:0,canHit:false,combo:0,oppPos:50,playerPos:50,canRushNet:false,rushingNet:false,gemActive:false,gemPos:{x:50,y:70},gemTimer:0,oppSpriteRow:0,settings:null};
let audio,sounds={};
function initAudio(){audio=new(window.AudioContext||window.webkitAudioContext)();sounds.hit=()=>playTone(150,0.03,0.4);sounds.bounce=()=>playTone(100,0.02,0.3);sounds.point=()=>{playTone(440,0.1,0.3);setTimeout(()=>playTone(880,0.15,0.3),100)};sounds.miss=()=>playTone(80,0.2,0.2);sounds.coin=()=>{playTone(1200,0.05,0.25);setTimeout(()=>playTone(1600,0.05,0.25),40)};sounds.gem=()=>{playTone(1800,0.08,0.3);setTimeout(()=>playTone(2200,0.08,0.3),50)}}
function playTone(f,d,v){if(!audio)return;const o=audio.createOscillator(),g=audio.createGain();o.frequency.value=f;o.connect(g);g.connect(audio.destination);g.gain.setValueAtTime(v,audio.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audio.currentTime+d);o.start();o.stop(audio.currentTime+d)}
function spawnGem(){if(!M.active||M.gemActive)return;M.gemActive=true;M.gemPos={x:20+Math.random()*60,y:60+Math.random()*25};M.gemTimer=10;const gem=document.getElementById('gemDrop');gem.classList.add('active');gem.style.left=M.gemPos.x+'%';gem.style.top=M.gemPos.y+'%';const interval=setInterval(()=>{M.gemTimer--;if(M.gemTimer<=0||!M.active){clearInterval(interval);hideGem()}},1000)}
function hideGem(){M.gemActive=false;document.getElementById('gemDrop').classList.remove('active')}
function collectGem(){if(!M.gemActive)return;const gems=Math.floor(Math.random()*3)+1;G.gems+=gems;M.gemActive=false;document.getElementById('gemDrop').classList.remove('active');sounds.gem();toast(`+${gems} gems!`);save();updateUI()}
function startGame(){if(!audio)initAudio();document.getElementById('loadingScreen').classList.remove('active');document.getElementById('mainMenu').classList.add('active');load();updateUI()}
function load(){const s=localStorage.getItem('tennisGame');if(s)Object.assign(G,JSON.parse(s))}
function save(){localStorage.setItem('tennisGame',JSON.stringify(G))}
function getStats(){const s={...G.stats};Object.values(SHOP).flat().forEach(i=>{if(G.owned.includes(i.id)&&Object.values(G.equipment).includes(i.id)){if(i.stats.power)s.power+=i.stats.power;if(i.stats.speed)s.speed+=i.stats.speed;if(i.stats.control)s.control+=i.stats.control}});return s}
const NTRP_LEVELS=[{rating:2.5,points:0},{rating:3.0,points:300},{rating:3.5,points:800},{rating:4.0,points:1500},{rating:4.5,points:2500},{rating:5.0,points:4000},{rating:5.5,points:6000}];
function getNTRP(){for(let i=NTRP_LEVELS.length-1;i>=0;i--){if(G.skillPoints>=NTRP_LEVELS[i].points)return NTRP_LEVELS[i].rating}return 2.5}
function getNextNTRP(){const current=getNTRP();const idx=NTRP_LEVELS.findIndex(l=>l.rating===current);if(idx<NTRP_LEVELS.length-1)return NTRP_LEVELS[idx+1];return null}
function updateUI(){const ntrp=getNTRP();const next=getNextNTRP();G.ntrp=ntrp;document.getElementById('playerNTRP').textContent=ntrp.toFixed(1);document.getElementById('coinAmount').textContent=G.coins;document.getElementById('gemAmount').textContent=G.gems;document.getElementById('skillPoints').textContent=G.skillPoints;if(next){document.getElementById('skillNeeded').textContent=next.points;const progress=(G.skillPoints/next.points)*100;document.getElementById('skillFill').style.width=progress+'%'}else{document.getElementById('skillNeeded').textContent='MAX';document.getElementById('skillFill').style.width='100%'}const s=getStats();document.getElementById('statPower').textContent=s.power;document.getElementById('statSpeed').textContent=s.speed;document.getElementById('statControl').textContent=s.control}
function selectDifficulty(d){G.difficulty=d;document.querySelectorAll('.difficulty-btn').forEach(b=>b.classList.remove('selected'));document.querySelector('.diff-'+d).classList.add('selected')}
function showShop(){document.getElementById('mainMenu').classList.remove('active');document.getElementById('shopScreen').classList.add('active');renderShop('training')}
function closeShop(){document.getElementById('shopScreen').classList.remove('active');document.getElementById('mainMenu').classList.add('active');updateUI()}
function switchTab(cat,btn){document.querySelectorAll('.shop-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');renderShop(cat)}
function renderShop(cat){const c=document.getElementById('shopItems');c.innerHTML='';SHOP[cat].forEach(item=>{const owned=G.owned.includes(item.id);const equipped=Object.values(G.equipment).includes(item.id);const canBuy=(item.currency==='gems'?G.gems:G.coins)>=item.price;const isTraining=cat==='training';let statsHTML='';if(item.stats.skillPoints)statsHTML+=`<span class="item-stat">+${item.stats.skillPoints} Skill Pts</span>`;if(item.stats.power)statsHTML+=`<span class="item-stat">+${item.stats.power} PWR</span>`;if(item.stats.speed)statsHTML+=`<span class="item-stat">+${item.stats.speed} SPD</span>`;if(item.stats.control)statsHTML+=`<span class="item-stat">+${item.stats.control} CTL</span>`;if(item.stats.bonus)statsHTML+=`<span class="item-stat">${item.stats.bonus}</span>`;const d=document.createElement('div');d.className='shop-item'+(owned&&!isTraining?' owned':'');d.innerHTML=`<div class="item-info"><div class="item-name">${item.name}</div><div class="item-desc">${item.desc}</div><div class="item-stats">${statsHTML}</div></div><div class="item-purchase">${isTraining?`<div class="price-tag">${item.currency==='gems'?'ðŸ’Ž':'ðŸ’°'}${item.price}</div><button class="buy-btn" ${canBuy?`onclick="buyItem('${cat}','${item.id}')"`:'disabled'}>${item.repeatable?'START':'BUY'}</button>`:!owned?`<div class="price-tag">${item.currency==='gems'?'ðŸ’Ž':'ðŸ’°'}${item.price}</div><button class="buy-btn" ${canBuy?`onclick="buyItem('${cat}','${item.id}')"`:'disabled'}>BUY</button>`:equipped?'<div class="equipped-badge">EQUIPPED</div>':`<button class="equip-btn" onclick="equipItem('${cat}','${item.id}')">EQUIP</button>`}</div>`;c.appendChild(d)})}
function buyItem(cat,id){const item=SHOP[cat].find(i=>i.id===id);if(!item)return;const curr=item.currency==='gems'?'gems':'coins';if(G[curr]<item.price)return;G[curr]-=item.price;if(cat==='training'){if(item.stats.skillPoints){const oldNTRP=getNTRP();G.skillPoints+=item.stats.skillPoints;const newNTRP=getNTRP();if(newNTRP>oldNTRP){toast(`NTRP UPGRADED to ${newNTRP.toFixed(1)}!`);sounds.point()}}if(item.stats.power)G.stats.power+=item.stats.power;if(item.stats.speed)G.stats.speed+=item.stats.speed;if(item.stats.control)G.stats.control+=item.stats.control;G.trainingCompleted.push(id);toast(item.name+' completed!')}else{G.owned.push(id);const key=cat.slice(0,-1);if(!G.equipment[key])G.equipment[key]=id;toast(item.name+' purchased!')}save();renderShop(cat);updateUI()}
function equipItem(cat,id){G.equipment[cat.slice(0,-1)]=id;save();renderShop(cat);toast('Equipped!')}
function showTutorial(){document.getElementById('tutorialOverlay').classList.add('active')}
function closeTutorial(){document.getElementById('tutorialOverlay').classList.remove('active')}
function toast(msg){const t=document.getElementById('progressToast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
let ytPlayer;
function onYouTubeIframeAPIReady(){ytPlayer=new YT.Player('videoPlayer',{height:'100%',width:'100%',videoId:'dy1tT2lsISs',playerVars:{autoplay:0,controls:0,modestbranding:1,rel:0,showinfo:0,fs:0,playsinline:1},events:{onStateChange:onPlayerStateChange}})}
function onPlayerStateChange(event){if(event.data===YT.PlayerState.ENDED){transitionToCourt()}}
function transitionToCourt(){const videoIntro=document.getElementById('videoIntro');videoIntro.classList.add('fade-out');setTimeout(()=>{videoIntro.classList.remove('active','fade-out');actuallyStartMatch()},500)}
function actuallyStartMatch(){const s=DIFF[G.difficulty];M={active:true,pPoints:0,oPoints:0,pGames:0,oGames:0,time:s.time,rally:0,ballActive:false,ballPos:{x:50,y:10},ballVel:{x:0,y:0,z:0},ballH:100,ballBounces:0,canHit:false,combo:0,oppPos:50,playerPos:70,canRushNet:false,rushingNet:false,settings:s};setSpriteRow('opponentSprite',0);setSpriteRow('playerSprite',1);document.getElementById('gameHUD').classList.add('active');document.getElementById('gameCourt').classList.add('active');document.getElementById('playerPaddle').style.left='70%';updateMatchUI();startTimer();setTimeout(serve,1200)}
function startMatch(){document.getElementById('mainMenu').classList.remove('active');document.getElementById('videoIntro').classList.add('active');if(ytPlayer&&ytPlayer.playVideo){ytPlayer.seekTo(0);ytPlayer.playVideo()}else{setTimeout(()=>{if(ytPlayer&&ytPlayer.playVideo){ytPlayer.seekTo(0);ytPlayer.playVideo()}},1000)}}
function startTimer(){const int=setInterval(()=>{if(!M.active){clearInterval(int);return}M.time--;document.getElementById('matchTimer').textContent=Math.floor(M.time/60)+':'+(M.time%60).toString().padStart(2,'0');if(M.time<=0){clearInterval(int);endMatch()}},1000)}
function getTennisScore(pPoints,oPoints){const scores=['0','15','30','40'];if(pPoints<4&&oPoints<4)return{p:scores[pPoints],o:scores[oPoints]};if(pPoints===oPoints)return{p:'40',o:'40',deuce:true};if(pPoints>oPoints)return{p:'AD',o:'40'};return{p:'40',o:'AD'}}
function updateMatchUI(){const score=getTennisScore(M.pPoints,M.oPoints);document.getElementById('playerPoints').textContent=score.deuce?'DEUCE':score.p;document.getElementById('opponentPoints').textContent=score.deuce?'DEUCE':score.o;document.getElementById('playerGames').textContent=M.pGames;document.getElementById('opponentGames').textContent=M.oGames;document.getElementById('rallyCount').textContent=M.rally}
function scorePoint(player){if(player==='p')M.pPoints++;else M.oPoints++;const diff=M.pPoints-M.oPoints;if((M.pPoints>=4||M.oPoints>=4)&&Math.abs(diff)>=2){if(M.pPoints>M.oPoints){M.pGames++;toast('GAME! You won the game!');}else{M.oGames++;toast('GAME! Opponent won');}M.pPoints=0;M.oPoints=0;sounds.point();}updateMatchUI();if(checkEnd())return true;return false;}
function playSprite(spriteId,frames){const sprite=document.getElementById(spriteId);sprite.classList.remove('playing-4','playing-5','playing-7','playing-8');void sprite.offsetWidth;sprite.classList.add(frames===8?'playing-8':frames===7?'playing-7':frames===4?'playing-4':'playing-5');}
function setSpriteRow(spriteId,row){const sprite=document.getElementById(spriteId);const yPos=(row/3)*100;sprite.style.setProperty('--sprite-y',yPos+'%');sprite.style.backgroundPosition='0% '+yPos+'%'}
function serve(){if(!M.active)return;M.ballActive=true;M.ballPos={x:M.oppPos,y:10};M.ballH=80;M.ballBounces=0;const st=getStats();const spd=Math.max(0.4,M.settings.speed*0.65-st.control*0.001);const tx=M.playerPos+(Math.random()-0.5)*30;M.ballVel={x:(tx-M.ballPos.x)/100*1.1,y:spd,z:1.2};const ball=document.getElementById('ball'),shadow=document.getElementById('ballShadow');ball.classList.add('active');shadow.classList.add('active');document.getElementById('opponent').classList.add('hitting');playSprite('opponentSprite',8);setTimeout(()=>document.getElementById('opponent').classList.remove('hitting'),250);sounds.hit();animateBall()}
function animateBall(){if(!M.ballActive)return;M.ballPos.x+=M.ballVel.x;M.ballPos.y+=M.ballVel.y;M.ballH+=M.ballVel.z;M.ballVel.z-=0.15;if(M.ballH<=0&&M.ballVel.z<0){M.ballH=0;M.ballVel.z=-M.ballVel.z*0.7;sounds.bounce();if(M.ballPos.y>50)M.ballBounces++;if(M.ballBounces>1){ballMissed();return}}if(M.ballPos.x<10||M.ballPos.x>90){ballOut('wide');return}const ball=document.getElementById('ball'),shadow=document.getElementById('ballShadow');ball.style.left=M.ballPos.x+'%';ball.style.top=(M.ballPos.y-M.ballH/12)+'%';shadow.style.left=M.ballPos.x+'%';shadow.style.top=M.ballPos.y+'%';const st=getStats();const hzStart=Math.max(52,100-M.settings.hitWindow*100-st.control*0.12);if(M.ballPos.y>hzStart&&M.ballPos.y<90&&M.ballH<50&&M.ballBounces<=1&&!M.canHit){M.canHit=true;ball.classList.add('glowing');document.getElementById('hitZone').classList.add('active');document.getElementById('swipeHint').classList.add('active');document.getElementById('playerPaddle').classList.add('can-hit')}if(M.canHit&&(M.ballH>50||M.ballBounces>1)){M.canHit=false;ball.classList.remove('glowing');document.getElementById('hitZone').classList.remove('active');document.getElementById('swipeHint').classList.remove('active');document.getElementById('playerPaddle').classList.remove('can-hit')}if(M.ballPos.y>93){ballMissed();return}if(M.ballPos.y<50)updateOpp();updatePlayerDirection();requestAnimationFrame(animateBall)}
function updateOpp(){const diff=M.ballPos.x-M.oppPos;M.oppPos+=diff*M.settings.oppSpeed;document.getElementById('opponent').style.left=M.oppPos+'%'}
function ballOut(reason){M.ballActive=false;M.canHit=false;resetBallUI();M.combo=0;M.rally=0;sounds.miss();toast('OUT!');if(!scorePoint('o'))setTimeout(serve,1200)}
function ballMissed(){M.ballActive=false;M.canHit=false;resetBallUI();M.combo=0;M.rally=0;sounds.miss();if(!scorePoint('o'))setTimeout(serve,1200)}
function resetBallUI(){const ball=document.getElementById('ball'),shadow=document.getElementById('ballShadow');ball.classList.remove('active','glowing');shadow.classList.remove('active');document.getElementById('hitZone').classList.remove('active');document.getElementById('swipeHint').classList.remove('active');document.getElementById('playerPaddle').classList.remove('can-hit')}
function hitBall(power,angle){if(!M.canHit)return;M.canHit=false;const ball=document.getElementById('ball');ball.classList.remove('glowing');document.getElementById('hitZone').classList.remove('active');document.getElementById('swipeHint').classList.remove('active');document.getElementById('playerPaddle').classList.remove('can-hit');const pf=document.getElementById('powerFill');pf.style.width=(power*100)+'%';setTimeout(()=>pf.style.width='0%',400);const st=getStats();const dist=Math.abs(M.ballPos.x-M.playerPos);const acc=Math.max(0,1-dist/50);const qual=power*acc*(1+st.control/100);showHitEffect();playSprite('playerSprite',8);sounds.hit();if(qual>0.55){M.combo++;showCombo()}else{M.combo=0}returnBall(qual,angle)}
function showHitEffect(){const e=document.getElementById('hitEffect'),b=document.getElementById('ball');e.style.left=b.style.left;e.style.top=b.style.top;e.classList.add('active');setTimeout(()=>e.classList.remove('active'),600)}
function showCombo(){const texts=['NICE!','GREAT!','PERFECT!','AMAZING!'];const el=document.createElement('div');el.className='combo-text';el.textContent=texts[Math.min(M.combo-1,3)];el.style.left='50%';el.style.top='50%';el.style.animation='comboFloat 0.9s ease-out forwards';document.querySelector('.court').appendChild(el);setTimeout(()=>el.remove(),900)}
function returnBall(qual,angle){M.ballActive=true;M.ballBounces=0;M.rally++;if(M.rally>=3&&!M.canRushNet){M.canRushNet=true;toast('RUSH THE NET!');}if(Math.random()<0.08&&!M.gemActive)spawnGem();const st=getStats();const spd=1+st.power*0.012;const ctrl=1+st.control*0.008;const off=M.playerPos-M.ballPos.x;const ang=Math.sin(angle)*1.1*ctrl;const pos=off*0.018;M.ballH=30;M.ballVel={x:Math.max(-1.3,Math.min(1.3,(ang+pos)*0.75)),y:-1.6*spd*qual*0.65,z:2.5*qual};animateReturn()}
function animateReturn(){if(!M.ballActive)return;M.ballPos.x+=M.ballVel.x;M.ballPos.y+=M.ballVel.y;M.ballH+=M.ballVel.z;M.ballVel.z-=0.15;if(M.ballH<=0&&M.ballVel.z<0){M.ballH=0;M.ballVel.z=-M.ballVel.z*0.7;sounds.bounce()}if(M.ballPos.x<10||M.ballPos.x>90){M.ballActive=false;resetBallUI();M.combo=0;M.rally=0;sounds.miss();toast('OUT!');if(!scorePoint('o'))setTimeout(serve,1200);return}const ball=document.getElementById('ball'),shadow=document.getElementById('ballShadow');ball.style.left=M.ballPos.x+'%';ball.style.top=(M.ballPos.y-M.ballH/12)+'%';shadow.style.left=M.ballPos.x+'%';shadow.style.top=M.ballPos.y+'%';if(M.ballPos.y<12){M.ballActive=false;const st=getStats();const dist=Math.abs(M.ballPos.x-M.oppPos);const reach=dist<28;const hq=Math.max(0,1-dist*0.025);const prob=reach?(M.settings.oppAcc*hq-st.power*0.002):0;if(Math.random()<prob){M.rally++;M.ballBounces=0;updateMatchUI();M.ballPos={x:M.oppPos,y:12};M.ballH=60;const tx=M.playerPos>50?25+Math.random()*25:50+Math.random()*25;M.ballVel={x:(tx-M.ballPos.x)/100*1.8,y:M.settings.speed*0.6,z:1.5};document.getElementById('opponent').classList.add('hitting');playSprite('opponentSprite',8);setTimeout(()=>document.getElementById('opponent').classList.remove('hitting'),250);sounds.hit();M.ballActive=true;M.canHit=false;ball.classList.add('active');ball.classList.remove('glowing');shadow.classList.add('active');animateBall()}else{resetBallUI();M.rally=0;let reward=10+M.combo*5;if(G.equipment.special==='x1')reward*=2;G.coins+=reward;sounds.coin();toast('+'+reward+' coins!');if(!scorePoint('p'))setTimeout(serve,1200)}return}if(M.ballPos.y<50)updateOpp();updatePlayerDirection();requestAnimationFrame(animateReturn)}
function checkEnd(){const gameDiff=Math.abs(M.pGames-M.oGames);if((M.pGames>=6||M.oGames>=6)&&gameDiff>=2){endMatch();return true}if(M.time<=0){endMatch();return true}return false}
function endMatch(){M.active=false;const won=M.pGames>M.oGames;let coins=won?80:25;coins=Math.floor(coins*M.settings.mult);if(G.equipment.special==='x1')coins*=2;const skill=Math.floor((won?25:10)*M.settings.mult);let gems=0;if(won&&Math.random()<0.2*M.settings.mult)gems=Math.floor(Math.random()*3)+1;const oldNTRP=getNTRP();G.coins+=coins;G.skillPoints+=skill;G.gems+=gems;const newNTRP=getNTRP();if(newNTRP>oldNTRP){setTimeout(()=>{toast(`NTRP UPGRADED to ${newNTRP.toFixed(1)}!`);sounds.point()},1500)}save();document.getElementById('gameHUD').classList.remove('active');document.getElementById('gameCourt').classList.remove('active');const rt=document.getElementById('resultsTitle');rt.textContent=won?'VICTORY':'DEFEAT';rt.className='results-title '+(won?'victory':'defeat');document.getElementById('finalScore').textContent=M.pGames+' - '+M.oGames;document.getElementById('coinsEarned').textContent='+'+coins;document.getElementById('skillGained').textContent='+'+skill;document.getElementById('gemsEarned').textContent='+'+gems;document.getElementById('matchResults').classList.add('active');if(won)sounds.point()}
function returnToMenu(){document.getElementById('matchResults').classList.remove('active');document.getElementById('mainMenu').classList.add('active');resetBallUI();updateUI()}
let touchY=null,touchX=null,touchT=null;
document.addEventListener('touchstart',e=>{if(!M.active)return;const t=e.touches[0];touchY=t.clientY;touchX=t.clientX;touchT=Date.now();updatePlayerPos(t.clientX);setPlayerRunning(true)});
document.addEventListener('touchmove',e=>{if(!M.active)return;e.preventDefault();updatePlayerPos(e.touches[0].clientX)},{passive:false});
document.addEventListener('touchend',e=>{setPlayerRunning(false);if(!M.canHit||!touchY)return;const t=e.changedTouches[0];const dy=touchY-t.clientY;const dx=t.clientX-touchX;const dt=Date.now()-touchT;if(dy>8||(dt<180&&Math.abs(dy)<8)){const pwr=Math.min(1,Math.max(0.3,dy/90));const ang=Math.atan2(dx,Math.max(1,dy));hitBall(pwr,ang)}touchY=touchX=null});
document.addEventListener('mousedown',e=>{if(!M.active)return;touchY=e.clientY;touchX=e.clientX;touchT=Date.now();updatePlayerPos(e.clientX);setPlayerRunning(true)});
document.addEventListener('mousemove',e=>{if(!M.active)return;updatePlayerPos(e.clientX)});
document.addEventListener('mouseup',e=>{setPlayerRunning(false);if(!M.canHit||!touchY)return;const dy=touchY-e.clientY;const dx=e.clientX-touchX;if(dy>8||Date.now()-touchT<180){const pwr=Math.min(1,Math.max(0.3,dy/90));const ang=Math.atan2(dx,Math.max(1,dy));hitBall(pwr,ang)}touchY=touchX=null});
function updatePlayerPos(x){const court=document.querySelector('.court');if(!court)return;const r=court.getBoundingClientRect();const rel=((x-r.left)/r.width)*100;M.playerPos=Math.max(12,Math.min(88,rel));document.getElementById('playerPaddle').style.left=M.playerPos+'%';updatePlayerDirection()}
function updatePlayerDirection(){if(!M.ballActive)return;const playerSprite=document.querySelector('.player-sprite-active');if(!playerSprite)return;if(M.ballPos.x<M.playerPos){playerSprite.classList.add('flipped')}else{playerSprite.classList.remove('flipped')}}
document.getElementById('gemDrop').addEventListener('click',collectGem);
document.getElementById('gemDrop').addEventListener('touchstart',e=>{e.stopPropagation();collectGem()});
window.addEventListener('load',()=>{document.body.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});initSprites()});
const SPRITES={playerSwing:'player-retro-backswing.png',playerRun:'player-retro-run.png',oppSwing:'opponent-retro-frontswing.png',oppRun:'opponent-retro-run.png'};
function initSprites(){document.getElementById('opponentSprite').style.backgroundImage=`url(${SPRITES.oppSwing})`;document.getElementById('playerSprite').style.backgroundImage=`url(${SPRITES.playerSwing})`;new Image().src=SPRITES.playerRun;new Image().src=SPRITES.oppRun;}
function setPlayerRunning(running){const sprite=document.getElementById('playerSprite');if(running){sprite.style.backgroundImage=`url(${SPRITES.playerRun})`;sprite.classList.add('cycling')}else{sprite.classList.remove('cycling');sprite.style.backgroundImage=`url(${SPRITES.playerSwing})`;sprite.style.backgroundPosition='0 0'}}
</script>
</body>
</html>